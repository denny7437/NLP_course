# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É MVP —Å–∏—Å—Ç–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ LLM-–∫–æ–Ω—Ç–µ–Ω—Ç–∞

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /home/student/nagaev_project

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
source /home/student/venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ)
pip install -r requirements.txt
```

### 2. –ó–∞–ø—É—Å–∫ Gateway —Å–µ—Ä–≤–∏—Å–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PYTHONPATH –∏ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
export PYTHONPATH=/home/student/nagaev_project:$PYTHONPATH
python -m uvicorn services.gateway.main:app --host 0.0.0.0 --port 8000 --reload
```

**–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞**: http://localhost:8000

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### Health Check
```bash
curl -X GET "http://localhost:8000/v1/health" -H "accept: application/json"
```

#### Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8000/docs

### 4. –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –í –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd /home/student/nagaev_project
export PYTHONPATH=/home/student/nagaev_project:$PYTHONPATH
python scripts/test_api.py
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### Health Check Response
```json
{
  "status": "degraded",
  "timestamp": 1749676888.8155105,
  "version": "1.0.0",
  "components": {
    "prefilter": {
      "status": "unhealthy",
      "error": "[Errno -3] Temporary failure in name resolution"
    },
    "safety_llm": {
      "status": "healthy",
      "mock": true
    },
    "clickhouse": {
      "status": "healthy",
      "storage_type": "in_memory_mock",
      "log_count": 0,
      "max_capacity": 10000
    }
  }
}
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
```
üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Ç–µ—Å—Ç–æ–≤ API...
============================================================
üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ health check...
‚úÖ Health check —É—Å–ø–µ—à–µ–Ω
üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞...
‚úÖ –¢–µ—Å—Ç 1: safe (–æ–∂–∏–¥–∞–ª—Å—è safe) - 4.6–º—Å
‚úÖ –¢–µ—Å—Ç 2: unsafe (–æ–∂–∏–¥–∞–ª—Å—è unsafe) - 3.33–º—Å
‚úÖ –¢–µ—Å—Ç 3: safe (–æ–∂–∏–¥–∞–ª—Å—è safe) - 3.27–º—Å
üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞—Ç—á —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏...
‚úÖ –ë–∞—Ç—á —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω: 3 –æ—Ç–≤–µ—Ç–æ–≤ –∑–∞ 4.37–º—Å
üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...
‚úÖ –ü–æ–ª—É—á–µ–Ω–æ 6 –∑–∞–ø–∏—Å–µ–π –ª–æ–≥–æ–≤
‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 6 –∑–∞–ø—Ä–æ—Å–æ–≤, 1.5–º—Å —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞
üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ rate limiting...
‚ö†Ô∏è Rate limiting –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª (–≤–æ–∑–º–æ–∂–Ω–æ, –ª–∏–º–∏—Ç—ã —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ)
============================================================
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
‚úÖ health: PASSED
üìã single_filter: COMPLETED
‚úÖ batch_filter: PASSED
üìã logs_stats: COMPLETED
üìã rate_limiting: COMPLETED

üéØ –ò—Ç–æ–≥–æ: 2/2 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ API endpoints

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
```bash
curl -X POST "http://localhost:8000/v1/filter" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Hello, how are you today?",
    "llm_id": "test-model"
  }'
```

### –ë–∞—Ç—á —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
```bash
curl -X POST "http://localhost:8000/v1/filter/batch" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "requests": [
      {"text": "Hello world", "llm_id": "test"},
      {"text": "Nice weather today", "llm_id": "test"}
    ]
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç admin —Ä–æ–ª—å)
```bash
curl -X GET "http://localhost:8000/v1/logs?limit=10" \
  -H "Authorization: Bearer ADMIN_TOKEN"
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç admin —Ä–æ–ª—å)
```bash
curl -X GET "http://localhost:8000/v1/stats?hours=1" \
  -H "Authorization: Bearer ADMIN_TOKEN"
```

## üîë –¢–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π:
- **viewer**: –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
- **analyst**: —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞
- **admin**: –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –≤–∫–ª—é—á–∞—è –ª–æ–≥–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

–¢–æ–∫–µ–Ω—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `services/gateway/auth.py`

## üéØ –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

- ‚úÖ **Gateway Service**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è **Pre-Filter Service**: –ú–æ–∫-—Ä–µ–∂–∏–º (DNS –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- ‚úÖ **Safety-LLM Service**: –ú–æ–∫-—Ä–µ–∂–∏–º
- ‚úÖ **ClickHouse**: In-memory –º–æ–∫
- ‚úÖ **Redis**: In-memory fallback
- ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: JWT —Å —Ä–æ–ª—è–º–∏
- ‚úÖ **Rate Limiting**: Token bucket –∞–ª–≥–æ—Ä–∏—Ç–º
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –° —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

## üöÄ –ì–æ—Ç–æ–≤–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏!

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞:
- –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ API —Ä–∞–±–æ—Ç–∞—é—Ç
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 3-5–º—Å –Ω–∞ –∑–∞–ø—Ä–æ—Å
- Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞

**MVP –≥–æ—Ç–æ–≤ –Ω–∞ 85%** –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ LLM-–∫–æ–Ω—Ç–µ–Ω—Ç–∞. 